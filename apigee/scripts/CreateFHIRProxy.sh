#!/bin/bash
#set -x
#set -e
echo "Received input $1 $2 $3 $6"


usage() {
  echo "Usage: $(basename $0) [outfile] [apigee-orgaisation] [apigee-environment] [apigee-user] [apigee-password] [app-developer-email]"
  exit 0
}

if [ $# -eq 0 ]; then
    echo "Script cannot proceed without all the inputs..."
	usage
fi

scriptDir=`pwd`
repositoryLocation=`cd ../../;pwd`
proxyLocation=/apigee/src/gateway
stu3_template="${repositoryLocation}${proxyLocation}/fhir_stu3_template"
dstu2_template="${repositoryLocation}${proxyLocation}/fhir_dstu2_template"
r4_template="${repositoryLocation}${proxyLocation}/fhir_r4_template"
fhirApisProxy="${repositoryLocation}${proxyLocation}/fhirApis"

r4_scopes=` echo \"patient/Account.read\",\"patient/ActivityDefinition.read\",\"patient/AdverseEvent.read\",\"patient/AllergyIntolerance.read\",\"patient/Appointment.read\",\"patient/AppointmentResponse.read\",\"patient/AuditEvent.read\",\"patient/Basic.read\",\"patient/Binary.read\",\"patient/BiologicallyDerivedProduct.read\",\"patient/BodyStructure.read\",\"patient/Bundle.read\",\"patient/CapabilityStatement.read\",\"patient/CarePlan.read\",\"patient/CareTeam.read\",\"patient/CatalogEntry.read\",\"patient/ChargeItem.read\",\"patient/ChargeItemDefinition.read\",\"patient/Claim.read\",\"patient/ClaimResponse.read\",\"patient/ClinicalImpression.read\",\"patient/CodeSystem.read\",\"patient/Communication.read\",\"patient/CommunicationRequest.read\",\"patient/CompartmentDefinition.read\",\"patient/Composition.read\",\"patient/ConceptMap.read\",\"patient/Condition.read\",\"patient/Consent.read\",\"patient/Contract.read\",\"patient/Coverage.read\",\"patient/CoverageEligibilityRequest.read\",\"patient/CoverageEligibilityResponse.read\",\"patient/DetectedIssue.read\",\"patient/Device.read\",\"patient/DeviceDefinition.read\",\"patient/DeviceMetric.read\",\"patient/DeviceRequest.read\",\"patient/DeviceUseStatement.read\",\"patient/DiagnosticReport.read\",\"patient/DocumentManifest.read\",\"patient/DocumentReference.read\",\"patient/EffectEvidenceSynthesis.read\",\"patient/Encounter.read\",\"patient/Endpoint.read\",\"patient/EnrollmentRequest.read\",\"patient/EnrollmentResponse.read\",\"patient/EpisodeOfCare.read\",\"patient/EventDefinition.read\",\"patient/Evidence.read\",\"patient/EvidenceVariable.read\",\"patient/ExampleScenario.read\",\"patient/ExplanationOfBenefit.read\",\"patient/FamilyMemberHistory.read\",\"patient/Flag.read\",\"patient/Goal.read\",\"patient/GraphDefinition.read\",\"patient/Group.read\",\"patient/GuidanceResponse.read\",\"patient/HealthcareService.read\",\"patient/ImagingStudy.read\",\"patient/Immunization.read\",\"patient/ImmunizationEvaluation.read\",\"patient/ImmunizationRecommendation.read\",\"patient/ImplementationGuide.read\",\"patient/InsurancePlan.read\",\"patient/Invoice.read\",\"patient/Library.read\",\"patient/Linkage.read\",\"patient/List.read\",\"patient/Location.read\",\"patient/Measure.read\",\"patient/MeasureReport.read\",\"patient/Media.read\",\"patient/Medication.read\",\"patient/MedicationAdministration.read\",\"patient/MedicationDispense.read\",\"patient/MedicationKnowledge.read\",\"patient/MedicationRequest.read\",\"patient/MedicationStatement.read\",\"patient/MedicinalProduct.read\",\"patient/MedicinalProductAuthorization.read\",\"patient/MedicinalProductContraindication.read\",\"patient/MedicinalProductIndication.read\",\"patient/MedicinalProductIngredient.read\",\"patient/MedicinalProductInteraction.read\",\"patient/MedicinalProductManufactured.read\",\"patient/MedicinalProductPackaged.read\",\"patient/MedicinalProductPharmaceutical.read\",\"patient/MedicinalProductUndesirableEffect.read\",\"patient/MessageDefinition.read\",\"patient/MessageHeader.read\",\"patient/MolecularSequence.read\",\"patient/NamingSystem.read\",\"patient/NutritionOrder.read\",\"patient/Observation.read\",\"patient/ObservationDefinition.read\",\"patient/OperationDefinition.read\",\"patient/OperationOutcome.read\",\"patient/Organization.read\",\"patient/OrganizationAffiliation.read\",\"patient/Parameters.read\",\"patient/Patient.read\",\"patient/PaymentNotice.read\",\"patient/PaymentReconciliation.read\",\"patient/Person.read\",\"patient/PlanDefinition.read\",\"patient/Practitioner.read\",\"patient/PractitionerRole.read\",\"patient/Procedure.read\",\"patient/Provenance.read\",\"patient/Questionnaire.read\",\"patient/QuestionnaireResponse.read\",\"patient/RelatedPerson.read\",\"patient/RequestGroup.read\",\"patient/ResearchDefinition.read\",\"patient/ResearchElementDefinition.read\",\"patient/ResearchStudy.read\",\"patient/ResearchSubject.read\",\"patient/RiskAssessment.read\",\"patient/RiskEvidenceSynthesis.read\",\"patient/Schedule.read\",\"patient/SearchParameter.read\",\"patient/ServiceRequest.read\",\"patient/Slot.read\",\"patient/Specimen.read\",\"patient/SpecimenDefinition.read\",\"patient/StructureDefinition.read\",\"patient/StructureMap.read\",\"patient/Subscription.read\",\"patient/Substance.read\",\"patient/SubstancePolymer.read\",\"patient/SubstanceProtein.read\",\"patient/SubstanceReferenceInformation.read\",\"patient/SubstanceSpecification.read\",\"patient/SubstanceSourceMaterial.read\",\"patient/SupplyDelivery.read\",\"patient/SupplyRequest.read\",\"patient/Task.read\",\"patient/TerminologyCapabilities.read\",\"patient/TestReport.read\",\"patient/TestScript.read\",\"patient/ValueSet.read\",\"patient/VerificationResult.read\",\"patient/VisionPrescription.read\",\"patient/Account.write\",\"patient/ActivityDefinition.write\",\"patient/AdverseEvent.write\",\"patient/AllergyIntolerance.write\",\"patient/Appointment.write\",\"patient/AppointmentResponse.write\",\"patient/AuditEvent.write\",\"patient/Basic.write\",\"patient/Binary.write\",\"patient/BiologicallyDerivedProduct.write\",\"patient/BodyStructure.write\",\"patient/Bundle.write\",\"patient/CapabilityStatement.write\",\"patient/CarePlan.write\",\"patient/CareTeam.write\",\"patient/CatalogEntry.write\",\"patient/ChargeItem.write\",\"patient/ChargeItemDefinition.write\",\"patient/Claim.write\",\"patient/ClaimResponse.write\",\"patient/ClinicalImpression.write\",\"patient/CodeSystem.write\",\"patient/Communication.write\",\"patient/CommunicationRequest.write\",\"patient/CompartmentDefinition.write\",\"patient/Composition.write\",\"patient/ConceptMap.write\",\"patient/Condition.write\",\"patient/Consent.write\",\"patient/Contract.write\",\"patient/Coverage.write\",\"patient/CoverageEligibilityRequest.write\",\"patient/CoverageEligibilityResponse.write\",\"patient/DetectedIssue.write\",\"patient/Device.write\",\"patient/DeviceDefinition.write\",\"patient/DeviceMetric.write\",\"patient/DeviceRequest.write\",\"patient/DeviceUseStatement.write\",\"patient/DiagnosticReport.write\",\"patient/DocumentManifest.write\",\"patient/DocumentReference.write\",\"patient/EffectEvidenceSynthesis.write\",\"patient/Encounter.write\",\"patient/Endpoint.write\",\"patient/EnrollmentRequest.write\",\"patient/EnrollmentResponse.write\",\"patient/EpisodeOfCare.write\",\"patient/EventDefinition.write\",\"patient/Evidence.write\",\"patient/EvidenceVariable.write\",\"patient/ExampleScenario.write\",\"patient/ExplanationOfBenefit.write\",\"patient/FamilyMemberHistory.write\",\"patient/Flag.write\",\"patient/Goal.write\",\"patient/GraphDefinition.write\",\"patient/Group.write\",\"patient/GuidanceResponse.write\",\"patient/HealthcareService.write\",\"patient/ImagingStudy.write\",\"patient/Immunization.write\",\"patient/ImmunizationEvaluation.write\",\"patient/ImmunizationRecommendation.write\",\"patient/ImplementationGuide.write\",\"patient/InsurancePlan.write\",\"patient/Invoice.write\",\"patient/Library.write\",\"patient/Linkage.write\",\"patient/List.write\",\"patient/Location.write\",\"patient/Measure.write\",\"patient/MeasureReport.write\",\"patient/Media.write\",\"patient/Medication.write\",\"patient/MedicationAdministration.write\",\"patient/MedicationDispense.write\",\"patient/MedicationKnowledge.write\",\"patient/MedicationRequest.write\",\"patient/MedicationStatement.write\",\"patient/MedicinalProduct.write\",\"patient/MedicinalProductAuthorization.write\",\"patient/MedicinalProductContraindication.write\",\"patient/MedicinalProductIndication.write\",\"patient/MedicinalProductIngredient.write\",\"patient/MedicinalProductInteraction.write\",\"patient/MedicinalProductManufactured.write\",\"patient/MedicinalProductPackaged.write\",\"patient/MedicinalProductPharmaceutical.write\",\"patient/MedicinalProductUndesirableEffect.write\",\"patient/MessageDefinition.write\",\"patient/MessageHeader.write\",\"patient/MolecularSequence.write\",\"patient/NamingSystem.write\",\"patient/NutritionOrder.write\",\"patient/Observation.write\",\"patient/ObservationDefinition.write\",\"patient/OperationDefinition.write\",\"patient/OperationOutcome.write\",\"patient/Organization.write\",\"patient/OrganizationAffiliation.write\",\"patient/Parameters.write\",\"patient/Patient.write\",\"patient/PaymentNotice.write\",\"patient/PaymentReconciliation.write\",\"patient/Person.write\",\"patient/PlanDefinition.write\",\"patient/Practitioner.write\",\"patient/PractitionerRole.write\",\"patient/Procedure.write\",\"patient/Provenance.write\",\"patient/Questionnaire.write\",\"patient/QuestionnaireResponse.write\",\"patient/RelatedPerson.write\",\"patient/RequestGroup.write\",\"patient/ResearchDefinition.write\",\"patient/ResearchElementDefinition.write\",\"patient/ResearchStudy.write\",\"patient/ResearchSubject.write\",\"patient/RiskAssessment.write\",\"patient/RiskEvidenceSynthesis.write\",\"patient/Schedule.write\",\"patient/SearchParameter.write\",\"patient/ServiceRequest.write\",\"patient/Slot.write\",\"patient/Specimen.write\",\"patient/SpecimenDefinition.write\",\"patient/StructureDefinition.write\",\"patient/StructureMap.write\",\"patient/Subscription.write\",\"patient/Substance.write\",\"patient/SubstancePolymer.write\",\"patient/SubstanceProtein.write\",\"patient/SubstanceReferenceInformation.write\",\"patient/SubstanceSpecification.write\",\"patient/SubstanceSourceMaterial.write\",\"patient/SupplyDelivery.write\",\"patient/SupplyRequest.write\",\"patient/Task.write\",\"patient/TerminologyCapabilities.write\",\"patient/TestReport.write\",\"patient/TestScript.write\",\"patient/ValueSet.write\",\"patient/VerificationResult.write\",\"patient/VisionPrescription.write\",\"user/Account.read\",\"user/ActivityDefinition.read\",\"user/AdverseEvent.read\",\"user/AllergyIntolerance.read\",\"user/Appointment.read\",\"user/AppointmentResponse.read\",\"user/AuditEvent.read\",\"user/Basic.read\",\"user/Binary.read\",\"user/BiologicallyDerivedProduct.read\",\"user/BodyStructure.read\",\"user/Bundle.read\",\"user/CapabilityStatement.read\",\"user/CarePlan.read\",\"user/CareTeam.read\",\"user/CatalogEntry.read\",\"user/ChargeItem.read\",\"user/ChargeItemDefinition.read\",\"user/Claim.read\",\"user/ClaimResponse.read\",\"user/ClinicalImpression.read\",\"user/CodeSystem.read\",\"user/Communication.read\",\"user/CommunicationRequest.read\",\"user/CompartmentDefinition.read\",\"user/Composition.read\",\"user/ConceptMap.read\",\"user/Condition.read\",\"user/Consent.read\",\"user/Contract.read\",\"user/Coverage.read\",\"user/CoverageEligibilityRequest.read\",\"user/CoverageEligibilityResponse.read\",\"user/DetectedIssue.read\",\"user/Device.read\",\"user/DeviceDefinition.read\",\"user/DeviceMetric.read\",\"user/DeviceRequest.read\",\"user/DeviceUseStatement.read\",\"user/DiagnosticReport.read\",\"user/DocumentManifest.read\",\"user/DocumentReference.read\",\"user/EffectEvidenceSynthesis.read\",\"user/Encounter.read\",\"user/Endpoint.read\",\"user/EnrollmentRequest.read\",\"user/EnrollmentResponse.read\",\"user/EpisodeOfCare.read\",\"user/EventDefinition.read\",\"user/Evidence.read\",\"user/EvidenceVariable.read\",\"user/ExampleScenario.read\",\"user/ExplanationOfBenefit.read\",\"user/FamilyMemberHistory.read\",\"user/Flag.read\",\"user/Goal.read\",\"user/GraphDefinition.read\",\"user/Group.read\",\"user/GuidanceResponse.read\",\"user/HealthcareService.read\",\"user/ImagingStudy.read\",\"user/Immunization.read\",\"user/ImmunizationEvaluation.read\",\"user/ImmunizationRecommendation.read\",\"user/ImplementationGuide.read\",\"user/InsurancePlan.read\",\"user/Invoice.read\",\"user/Library.read\",\"user/Linkage.read\",\"user/List.read\",\"user/Location.read\",\"user/Measure.read\",\"user/MeasureReport.read\",\"user/Media.read\",\"user/Medication.read\",\"user/MedicationAdministration.read\",\"user/MedicationDispense.read\",\"user/MedicationKnowledge.read\",\"user/MedicationRequest.read\",\"user/MedicationStatement.read\",\"user/MedicinalProduct.read\",\"user/MedicinalProductAuthorization.read\",\"user/MedicinalProductContraindication.read\",\"user/MedicinalProductIndication.read\",\"user/MedicinalProductIngredient.read\",\"user/MedicinalProductInteraction.read\",\"user/MedicinalProductManufactured.read\",\"user/MedicinalProductPackaged.read\",\"user/MedicinalProductPharmaceutical.read\",\"user/MedicinalProductUndesirableEffect.read\",\"user/MessageDefinition.read\",\"user/MessageHeader.read\",\"user/MolecularSequence.read\",\"user/NamingSystem.read\",\"user/NutritionOrder.read\",\"user/Observation.read\",\"user/ObservationDefinition.read\",\"user/OperationDefinition.read\",\"user/OperationOutcome.read\",\"user/Organization.read\",\"user/OrganizationAffiliation.read\",\"user/Parameters.read\",\"user/user.read\",\"user/PaymentNotice.read\",\"user/PaymentReconciliation.read\",\"user/Person.read\",\"user/PlanDefinition.read\",\"user/Practitioner.read\",\"user/PractitionerRole.read\",\"user/Procedure.read\",\"user/Provenance.read\",\"user/Questionnaire.read\",\"user/QuestionnaireResponse.read\",\"user/RelatedPerson.read\",\"user/RequestGroup.read\",\"user/ResearchDefinition.read\",\"user/ResearchElementDefinition.read\",\"user/ResearchStudy.read\",\"user/ResearchSubject.read\",\"user/RiskAssessment.read\",\"user/RiskEvidenceSynthesis.read\",\"user/Schedule.read\",\"user/SearchParameter.read\",\"user/ServiceRequest.read\",\"user/Slot.read\",\"user/Specimen.read\",\"user/SpecimenDefinition.read\",\"user/StructureDefinition.read\",\"user/StructureMap.read\",\"user/Subscription.read\",\"user/Substance.read\",\"user/SubstancePolymer.read\",\"user/SubstanceProtein.read\",\"user/SubstanceReferenceInformation.read\",\"user/SubstanceSpecification.read\",\"user/SubstanceSourceMaterial.read\",\"user/SupplyDelivery.read\",\"user/SupplyRequest.read\",\"user/Task.read\",\"user/TerminologyCapabilities.read\",\"user/TestReport.read\",\"user/TestScript.read\",\"user/ValueSet.read\",\"user/VerificationResult.read\",\"user/VisionPrescription.read\",\"user/Account.write\",\"user/ActivityDefinition.write\",\"user/AdverseEvent.write\",\"user/AllergyIntolerance.write\",\"user/Appointment.write\",\"user/AppointmentResponse.write\",\"user/AuditEvent.write\",\"user/Basic.write\",\"user/Binary.write\",\"user/BiologicallyDerivedProduct.write\",\"user/BodyStructure.write\",\"user/Bundle.write\",\"user/CapabilityStatement.write\",\"user/CarePlan.write\",\"user/CareTeam.write\",\"user/CatalogEntry.write\",\"user/ChargeItem.write\",\"user/ChargeItemDefinition.write\",\"user/Claim.write\",\"user/ClaimResponse.write\",\"user/ClinicalImpression.write\",\"user/CodeSystem.write\",\"user/Communication.write\",\"user/CommunicationRequest.write\",\"user/CompartmentDefinition.write\",\"user/Composition.write\",\"user/ConceptMap.write\",\"user/Condition.write\",\"user/Consent.write\",\"user/Contract.write\",\"user/Coverage.write\",\"user/CoverageEligibilityRequest.write\",\"user/CoverageEligibilityResponse.write\",\"user/DetectedIssue.write\",\"user/Device.write\",\"user/DeviceDefinition.write\",\"user/DeviceMetric.write\",\"user/DeviceRequest.write\",\"user/DeviceUseStatement.write\",\"user/DiagnosticReport.write\",\"user/DocumentManifest.write\",\"user/DocumentReference.write\",\"user/EffectEvidenceSynthesis.write\",\"user/Encounter.write\",\"user/Endpoint.write\",\"user/EnrollmentRequest.write\",\"user/EnrollmentResponse.write\",\"user/EpisodeOfCare.write\",\"user/EventDefinition.write\",\"user/Evidence.write\",\"user/EvidenceVariable.write\",\"user/ExampleScenario.write\",\"user/ExplanationOfBenefit.write\",\"user/FamilyMemberHistory.write\",\"user/Flag.write\",\"user/Goal.write\",\"user/GraphDefinition.write\",\"user/Group.write\",\"user/GuidanceResponse.write\",\"user/HealthcareService.write\",\"user/ImagingStudy.write\",\"user/Immunization.write\",\"user/ImmunizationEvaluation.write\",\"user/ImmunizationRecommendation.write\",\"user/ImplementationGuide.write\",\"user/InsurancePlan.write\",\"user/Invoice.write\",\"user/Library.write\",\"user/Linkage.write\",\"user/List.write\",\"user/Location.write\",\"user/Measure.write\",\"user/MeasureReport.write\",\"user/Media.write\",\"user/Medication.write\",\"user/MedicationAdministration.write\",\"user/MedicationDispense.write\",\"user/MedicationKnowledge.write\",\"user/MedicationRequest.write\",\"user/MedicationStatement.write\",\"user/MedicinalProduct.write\",\"user/MedicinalProductAuthorization.write\",\"user/MedicinalProductContraindication.write\",\"user/MedicinalProductIndication.write\",\"user/MedicinalProductIngredient.write\",\"user/MedicinalProductInteraction.write\",\"user/MedicinalProductManufactured.write\",\"user/MedicinalProductPackaged.write\",\"user/MedicinalProductPharmaceutical.write\",\"user/MedicinalProductUndesirableEffect.write\",\"user/MessageDefinition.write\",\"user/MessageHeader.write\",\"user/MolecularSequence.write\",\"user/NamingSystem.write\",\"user/NutritionOrder.write\",\"user/Observation.write\",\"user/ObservationDefinition.write\",\"user/OperationDefinition.write\",\"user/OperationOutcome.write\",\"user/Organization.write\",\"user/OrganizationAffiliation.write\",\"user/Parameters.write\",\"user/user.write\",\"user/PaymentNotice.write\",\"user/PaymentReconciliation.write\",\"user/Person.write\",\"user/PlanDefinition.write\",\"user/Practitioner.write\",\"user/PractitionerRole.write\",\"user/Procedure.write\",\"user/Provenance.write\",\"user/Questionnaire.write\",\"user/QuestionnaireResponse.write\",\"user/RelatedPerson.write\",\"user/RequestGroup.write\",\"user/ResearchDefinition.write\",\"user/ResearchElementDefinition.write\",\"user/ResearchStudy.write\",\"user/ResearchSubject.write\",\"user/RiskAssessment.write\",\"user/RiskEvidenceSynthesis.write\",\"user/Schedule.write\",\"user/SearchParameter.write\",\"user/ServiceRequest.write\",\"user/Slot.write\",\"user/Specimen.write\",\"user/SpecimenDefinition.write\",\"user/StructureDefinition.write\",\"user/StructureMap.write\",\"user/Subscription.write\",\"user/Substance.write\",\"user/SubstancePolymer.write\",\"user/SubstanceProtein.write\",\"user/SubstanceReferenceInformation.write\",\"user/SubstanceSpecification.write\",\"user/SubstanceSourceMaterial.write\",\"user/SupplyDelivery.write\",\"user/SupplyRequest.write\",\"user/Task.write\",\"user/TerminologyCapabilities.write\",\"user/TestReport.write\",\"user/TestScript.write\",\"user/ValueSet.write\",\"user/VerificationResult.write\",\"user/VisionPrescription.write\"`
r4_scopes=` echo $r4_scopes,\"system/Account.read\",\"system/ActivityDefinition.read\",\"system/AdverseEvent.read\",\"system/AllergyIntolerance.read\",\"system/Appointment.read\",\"system/AppointmentResponse.read\",\"system/AuditEvent.read\",\"system/Basic.read\",\"system/Binary.read\",\"system/BiologicallyDerivedProduct.read\",\"system/BodyStructure.read\",\"system/Bundle.read\",\"system/CapabilityStatement.read\",\"system/CarePlan.read\",\"system/CareTeam.read\",\"system/CatalogEntry.read\",\"system/ChargeItem.read\",\"system/ChargeItemDefinition.read\",\"system/Claim.read\",\"system/ClaimResponse.read\",\"system/ClinicalImpression.read\",\"system/CodeSystem.read\",\"system/Communication.read\",\"system/CommunicationRequest.read\",\"system/CompartmentDefinition.read\",\"system/Composition.read\",\"system/ConceptMap.read\",\"system/Condition.read\",\"system/Consent.read\",\"system/Contract.read\",\"system/Coverage.read\",\"system/CoverageEligibilityRequest.read\",\"system/CoverageEligibilityResponse.read\",\"system/DetectedIssue.read\",\"system/Device.read\",\"system/DeviceDefinition.read\",\"system/DeviceMetric.read\",\"system/DeviceRequest.read\",\"system/DeviceUseStatement.read\",\"system/DiagnosticReport.read\",\"system/DocumentManifest.read\",\"system/DocumentReference.read\",\"system/EffectEvidenceSynthesis.read\",\"system/Encounter.read\",\"system/Endpoint.read\",\"system/EnrollmentRequest.read\",\"system/EnrollmentResponse.read\",\"system/EpisodeOfCare.read\",\"system/EventDefinition.read\",\"system/Evidence.read\",\"system/EvidenceVariable.read\",\"system/ExampleScenario.read\",\"system/ExplanationOfBenefit.read\",\"system/FamilyMemberHistory.read\",\"system/Flag.read\",\"system/Goal.read\",\"system/GraphDefinition.read\",\"system/Group.read\",\"system/GuidanceResponse.read\",\"system/HealthcareService.read\",\"system/ImagingStudy.read\",\"system/Immunization.read\",\"system/ImmunizationEvaluation.read\",\"system/ImmunizationRecommendation.read\",\"system/ImplementationGuide.read\",\"system/InsurancePlan.read\",\"system/Invoice.read\",\"system/Library.read\",\"system/Linkage.read\",\"system/List.read\",\"system/Location.read\",\"system/Measure.read\",\"system/MeasureReport.read\",\"system/Media.read\",\"system/Medication.read\",\"system/MedicationAdministration.read\",\"system/MedicationDispense.read\",\"system/MedicationKnowledge.read\",\"system/MedicationRequest.read\",\"system/MedicationStatement.read\",\"system/MedicinalProduct.read\",\"system/MedicinalProductAuthorization.read\",\"system/MedicinalProductContraindication.read\",\"system/MedicinalProductIndication.read\",\"system/MedicinalProductIngredient.read\",\"system/MedicinalProductInteraction.read\",\"system/MedicinalProductManufactured.read\",\"system/MedicinalProductPackaged.read\",\"system/MedicinalProductPharmaceutical.read\",\"system/MedicinalProductUndesirableEffect.read\",\"system/MessageDefinition.read\",\"system/MessageHeader.read\",\"system/MolecularSequence.read\",\"system/NamingSystem.read\",\"system/NutritionOrder.read\",\"system/Observation.read\",\"system/ObservationDefinition.read\",\"system/OperationDefinition.read\",\"system/OperationOutcome.read\",\"system/Organization.read\",\"system/OrganizationAffiliation.read\",\"system/Parameters.read\",\"system/system.read\",\"system/PaymentNotice.read\",\"system/PaymentReconciliation.read\",\"system/Person.read\",\"system/PlanDefinition.read\",\"system/Practitioner.read\",\"system/PractitionerRole.read\",\"system/Procedure.read\",\"system/Provenance.read\",\"system/Questionnaire.read\",\"system/QuestionnaireResponse.read\",\"system/RelatedPerson.read\",\"system/RequestGroup.read\",\"system/ResearchDefinition.read\",\"system/ResearchElementDefinition.read\",\"system/ResearchStudy.read\",\"system/ResearchSubject.read\",\"system/RiskAssessment.read\",\"system/RiskEvidenceSynthesis.read\",\"system/Schedule.read\",\"system/SearchParameter.read\",\"system/ServiceRequest.read\",\"system/Slot.read\",\"system/Specimen.read\",\"system/SpecimenDefinition.read\",\"system/StructureDefinition.read\",\"system/StructureMap.read\",\"system/Subscription.read\",\"system/Substance.read\",\"system/SubstancePolymer.read\",\"system/SubstanceProtein.read\",\"system/SubstanceReferenceInformation.read\",\"system/SubstanceSpecification.read\",\"system/SubstanceSourceMaterial.read\",\"system/SupplyDelivery.read\",\"system/SupplyRequest.read\",\"system/Task.read\",\"system/TerminologyCapabilities.read\",\"system/TestReport.read\",\"system/TestScript.read\",\"system/ValueSet.read\",\"system/VerificationResult.read\",\"system/VisionPrescription.read\",\"system/Account.write\",\"system/ActivityDefinition.write\",\"system/AdverseEvent.write\",\"system/AllergyIntolerance.write\",\"system/Appointment.write\",\"system/AppointmentResponse.write\",\"system/AuditEvent.write\",\"system/Basic.write\",\"system/Binary.write\",\"system/BiologicallyDerivedProduct.write\",\"system/BodyStructure.write\",\"system/Bundle.write\",\"system/CapabilityStatement.write\",\"system/CarePlan.write\",\"system/CareTeam.write\",\"system/CatalogEntry.write\",\"system/ChargeItem.write\",\"system/ChargeItemDefinition.write\",\"system/Claim.write\",\"system/ClaimResponse.write\",\"system/ClinicalImpression.write\",\"system/CodeSystem.write\",\"system/Communication.write\",\"system/CommunicationRequest.write\",\"system/CompartmentDefinition.write\",\"system/Composition.write\",\"system/ConceptMap.write\",\"system/Condition.write\",\"system/Consent.write\",\"system/Contract.write\",\"system/Coverage.write\",\"system/CoverageEligibilityRequest.write\",\"system/CoverageEligibilityResponse.write\",\"system/DetectedIssue.write\",\"system/Device.write\",\"system/DeviceDefinition.write\",\"system/DeviceMetric.write\",\"system/DeviceRequest.write\",\"system/DeviceUseStatement.write\",\"system/DiagnosticReport.write\",\"system/DocumentManifest.write\",\"system/DocumentReference.write\",\"system/EffectEvidenceSynthesis.write\",\"system/Encounter.write\",\"system/Endpoint.write\",\"system/EnrollmentRequest.write\",\"system/EnrollmentResponse.write\",\"system/EpisodeOfCare.write\",\"system/EventDefinition.write\",\"system/Evidence.write\",\"system/EvidenceVariable.write\",\"system/ExampleScenario.write\",\"system/ExplanationOfBenefit.write\",\"system/FamilyMemberHistory.write\",\"system/Flag.write\",\"system/Goal.write\",\"system/GraphDefinition.write\",\"system/Group.write\",\"system/GuidanceResponse.write\",\"system/HealthcareService.write\",\"system/ImagingStudy.write\",\"system/Immunization.write\",\"system/ImmunizationEvaluation.write\",\"system/ImmunizationRecommendation.write\",\"system/ImplementationGuide.write\",\"system/InsurancePlan.write\",\"system/Invoice.write\",\"system/Library.write\",\"system/Linkage.write\",\"system/List.write\",\"system/Location.write\",\"system/Measure.write\",\"system/MeasureReport.write\",\"system/Media.write\",\"system/Medication.write\",\"system/MedicationAdministration.write\",\"system/MedicationDispense.write\",\"system/MedicationKnowledge.write\",\"system/MedicationRequest.write\",\"system/MedicationStatement.write\",\"system/MedicinalProduct.write\",\"system/MedicinalProductAuthorization.write\",\"system/MedicinalProductContraindication.write\",\"system/MedicinalProductIndication.write\",\"system/MedicinalProductIngredient.write\",\"system/MedicinalProductInteraction.write\",\"system/MedicinalProductManufactured.write\",\"system/MedicinalProductPackaged.write\",\"system/MedicinalProductPharmaceutical.write\",\"system/MedicinalProductUndesirableEffect.write\",\"system/MessageDefinition.write\",\"system/MessageHeader.write\",\"system/MolecularSequence.write\",\"system/NamingSystem.write\",\"system/NutritionOrder.write\",\"system/Observation.write\",\"system/ObservationDefinition.write\",\"system/OperationDefinition.write\",\"system/OperationOutcome.write\",\"system/Organization.write\",\"system/OrganizationAffiliation.write\",\"system/Parameters.write\",\"system/system.write\",\"system/PaymentNotice.write\",\"system/PaymentReconciliation.write\",\"system/Person.write\",\"system/PlanDefinition.write\",\"system/Practitioner.write\",\"system/PractitionerRole.write\",\"system/Procedure.write\",\"system/Provenance.write\",\"system/Questionnaire.write\",\"system/QuestionnaireResponse.write\",\"system/RelatedPerson.write\",\"system/RequestGroup.write\",\"system/ResearchDefinition.write\",\"system/ResearchElementDefinition.write\",\"system/ResearchStudy.write\",\"system/ResearchSubject.write\",\"system/RiskAssessment.write\",\"system/RiskEvidenceSynthesis.write\",\"system/Schedule.write\",\"system/SearchParameter.write\",\"system/ServiceRequest.write\",\"system/Slot.write\",\"system/Specimen.write\",\"system/SpecimenDefinition.write\",\"system/StructureDefinition.write\",\"system/StructureMap.write\",\"system/Subscription.write\",\"system/Substance.write\",\"system/SubstancePolymer.write\",\"system/SubstanceProtein.write\",\"system/SubstanceReferenceInformation.write\",\"system/SubstanceSpecification.write\",\"system/SubstanceSourceMaterial.write\",\"system/SupplyDelivery.write\",\"system/SupplyRequest.write\",\"system/Task.write\",\"system/TerminologyCapabilities.write\",\"system/TestReport.write\",\"system/TestScript.write\",\"system/ValueSet.write\",\"system/VerificationResult.write\",\"system/VisionPrescription.write\"`
stu3_scopes=` echo \"patient/Account.read\",\"patient/ActivityDefinition.read\",\"patient/AllergyIntolerance.read\",\"patient/AdverseEvent.read\",\"patient/Appointment.read\",\"patient/AppointmentResponse.read\",\"patient/AuditEvent.read\",\"patient/Basic.read\",\"patient/Binary.read\",\"patient/BodySite.read\",\"patient/Bundle.read\",\"patient/CapabilityStatement.read\",\"patient/CarePlan.read\",\"patient/CareTeam.read\",\"patient/ChargeItem.read\",\"patient/Claim.read\",\"patient/ClaimResponse.read\",\"patient/ClinicalImpression.read\",\"patient/CodeSystem.read\",\"patient/Communication.read\",\"patient/CommunicationRequest.read\",\"patient/CompartmentDefinition.read\",\"patient/Composition.read\",\"patient/ConceptMap.read\",\"patient/Condition.read\",\"patient/Consent.read\",\"patient/Contract.read\",\"patient/Coverage.read\",\"patient/DataElement.read\",\"patient/DetectedIssue.read\",\"patient/Device.read\",\"patient/DeviceComponent.read\",\"patient/DeviceMetric.read\",\"patient/DeviceRequest.read\",\"patient/DeviceUseStatement.read\",\"patient/DiagnosticReport.read\",\"patient/DocumentManifest.read\",\"patient/DocumentReference.read\",\"patient/EligibilityRequest.read\",\"patient/EligibilityResponse.read\",\"patient/Encounter.read\",\"patient/Endpoint.read\",\"patient/EnrollmentRequest.read\",\"patient/EnrollmentResponse.read\",\"patient/EpisodeOfCare.read\",\"patient/ExpansionProfile.read\",\"patient/ExplanationOfBenefit.read\",\"patient/FamilyMemberHistory.read\",\"patient/Flag.read\",\"patient/Goal.read\",\"patient/GraphDefinition.read\",\"patient/Group.read\",\"patient/GuidanceResponse.read\",\"patient/HealthcareService.read\",\"patient/ImagingManifest.read\",\"patient/ImagingStudy.read\",\"patient/Immunization.read\",\"patient/ImmunizationRecommendation.read\",\"patient/ImplementationGuide.read\",\"patient/Library.read\",\"patient/Linkage.read\",\"patient/List.read\",\"patient/Location.read\",\"patient/Measure.read\",\"patient/MeasureReport.read\",\"patient/Media.read\",\"patient/Medication.read\",\"patient/MedicationAdministration.read\",\"patient/MedicationDispense.read\",\"patient/MedicationRequest.read\",\"patient/MedicationStatement.read\",\"patient/MessageDefinition.read\",\"patient/MessageHeader.read\",\"patient/NamingSystem.read\",\"patient/NutritionOrder.read\",\"patient/Observation.read\",\"patient/OperationDefinition.read\",\"patient/OperationOutcome.read\",\"patient/Organization.read\",\"patient/Parameters.read\",\"patient/Patient.read\",\"patient/PaymentNotice.read\",\"patient/PaymentReconciliation.read\",\"patient/Person.read\",\"patient/PlanDefinition.read\",\"patient/Practitioner.read\",\"patient/PractitionerRole.read\",\"patient/Procedure.read\",\"patient/ProcedureRequest.read\",\"patient/ProcessRequest.read\",\"patient/ProcessResponse.read\",\"patient/Provenance.read\",\"patient/Questionnaire.read\",\"patient/QuestionnaireResponse.read\",\"patient/ReferralRequest.read\",\"patient/RelatedPerson.read\",\"patient/RequestGroup.read\",\"patient/ResearchStudy.read\",\"patient/ResearchSubject.read\",\"patient/RiskAssessment.read\",\"patient/Schedule.read\",\"patient/SearchParameter.read\",\"patient/Sequence.read\",\"patient/ServiceDefinition.read\",\"patient/Slot.read\",\"patient/Specimen.read\",\"patient/StructureDefinition.read\",\"patient/StructureMap.read\",\"patient/Subscription.read\",\"patient/Substance.read\",\"patient/SupplyDelivery.read\",\"patient/SupplyRequest.read\",\"patient/Task.read\",\"patient/TestScript.read\",\"patient/TestReport.read\",\"patient/ValueSet.read\",\"patient/VisionPrescription.read\",\"patient/Account.write\",\"patient/ActivityDefinition.write\",\"patient/AllergyIntolerance.write\",\"patient/AdverseEvent.write\",\"patient/Appointment.write\",\"patient/AppointmentResponse.write\",\"patient/AuditEvent.write\",\"patient/Basic.write\",\"patient/Binary.write\",\"patient/BodySite.write\",\"patient/Bundle.write\",\"patient/CapabilityStatement.write\",\"patient/CarePlan.write\",\"patient/CareTeam.write\",\"patient/ChargeItem.write\",\"patient/Claim.write\",\"patient/ClaimResponse.write\",\"patient/ClinicalImpression.write\",\"patient/CodeSystem.write\",\"patient/Communication.write\",\"patient/CommunicationRequest.write\",\"patient/CompartmentDefinition.write\",\"patient/Composition.write\",\"patient/ConceptMap.write\",\"patient/Condition.write\",\"patient/Consent.write\",\"patient/Contract.write\",\"patient/Coverage.write\",\"patient/DataElement.write\",\"patient/DetectedIssue.write\",\"patient/Device.write\",\"patient/DeviceComponent.write\",\"patient/DeviceMetric.write\",\"patient/DeviceRequest.write\",\"patient/DeviceUseStatement.write\",\"patient/DiagnosticReport.write\",\"patient/DocumentManifest.write\",\"patient/DocumentReference.write\",\"patient/EligibilityRequest.write\",\"patient/EligibilityResponse.write\",\"patient/Encounter.write\",\"patient/Endpoint.write\",\"patient/EnrollmentRequest.write\",\"patient/EnrollmentResponse.write\",\"patient/EpisodeOfCare.write\",\"patient/ExpansionProfile.write\",\"patient/ExplanationOfBenefit.write\",\"patient/FamilyMemberHistory.write\",\"patient/Flag.write\",\"patient/Goal.write\",\"patient/GraphDefinition.write\",\"patient/Group.write\",\"patient/GuidanceResponse.write\",\"patient/HealthcareService.write\",\"patient/ImagingManifest.write\",\"patient/ImagingStudy.write\",\"patient/Immunization.write\",\"patient/ImmunizationRecommendation.write\",\"patient/ImplementationGuide.write\",\"patient/Library.write\",\"patient/Linkage.write\",\"patient/List.write\",\"patient/Location.write\",\"patient/Measure.write\",\"patient/MeasureReport.write\",\"patient/Media.write\",\"patient/Medication.write\",\"patient/MedicationAdministration.write\",\"patient/MedicationDispense.write\",\"patient/MedicationRequest.write\",\"patient/MedicationStatement.write\",\"patient/MessageDefinition.write\",\"patient/MessageHeader.write\",\"patient/NamingSystem.write\",\"patient/NutritionOrder.write\",\"patient/Observation.write\",\"patient/OperationDefinition.write\",\"patient/OperationOutcome.write\",\"patient/Organization.write\",\"patient/Parameters.write\",\"patient/Patient.write\",\"patient/PaymentNotice.write\",\"patient/PaymentReconciliation.write\",\"patient/Person.write\",\"patient/PlanDefinition.write\",\"patient/Practitioner.write\",\"patient/PractitionerRole.write\",\"patient/Procedure.write\",\"patient/ProcedureRequest.write\",\"patient/ProcessRequest.write\",\"patient/ProcessResponse.write\",\"patient/Provenance.write\",\"patient/Questionnaire.write\",\"patient/QuestionnaireResponse.write\",\"patient/ReferralRequest.write\",\"patient/RelatedPerson.write\",\"patient/RequestGroup.write\",\"patient/ResearchStudy.write\",\"patient/ResearchSubject.write\",\"patient/RiskAssessment.write\",\"patient/Schedule.write\",\"patient/SearchParameter.write\",\"patient/Sequence.write\",\"patient/ServiceDefinition.write\",\"patient/Slot.write\",\"patient/Specimen.write\",\"patient/StructureDefinition.write\",\"patient/StructureMap.write\",\"patient/Subscription.write\",\"patient/Substance.write\",\"patient/SupplyDelivery.write\",\"patient/SupplyRequest.write\",\"patient/Task.write\",\"patient/TestScript.write\",\"patient/TestReport.write\",\"patient/ValueSet.write\",\"patient/VisionPrescription.write\",\"user/Account.read\",\"user/ActivityDefinition.read\",\"user/AllergyIntolerance.read\",\"user/AdverseEvent.read\",\"user/Appointment.read\",\"user/AppointmentResponse.read\",\"user/AuditEvent.read\",\"user/Basic.read\",\"user/Binary.read\",\"user/BodySite.read\",\"user/Bundle.read\",\"user/CapabilityStatement.read\",\"user/CarePlan.read\",\"user/CareTeam.read\",\"user/ChargeItem.read\",\"user/Claim.read\",\"user/ClaimResponse.read\",\"user/ClinicalImpression.read\",\"user/CodeSystem.read\",\"user/Communication.read\",\"user/CommunicationRequest.read\",\"user/CompartmentDefinition.read\",\"user/Composition.read\",\"user/ConceptMap.read\",\"user/Condition.read\",\"user/Consent.read\",\"user/Contract.read\",\"user/Coverage.read\",\"user/DataElement.read\",\"user/DetectedIssue.read\",\"user/Device.read\",\"user/DeviceComponent.read\",\"user/DeviceMetric.read\",\"user/DeviceRequest.read\",\"user/DeviceUseStatement.read\",\"user/DiagnosticReport.read\",\"user/DocumentManifest.read\",\"user/DocumentReference.read\",\"user/EligibilityRequest.read\",\"user/EligibilityResponse.read\",\"user/Encounter.read\",\"user/Endpoint.read\",\"user/EnrollmentRequest.read\",\"user/EnrollmentResponse.read\",\"user/EpisodeOfCare.read\",\"user/ExpansionProfile.read\",\"user/ExplanationOfBenefit.read\",\"user/FamilyMemberHistory.read\",\"user/Flag.read\",\"user/Goal.read\",\"user/GraphDefinition.read\",\"user/Group.read\",\"user/GuidanceResponse.read\",\"user/HealthcareService.read\",\"user/ImagingManifest.read\",\"user/ImagingStudy.read\",\"user/Immunization.read\",\"user/ImmunizationRecommendation.read\",\"user/ImplementationGuide.read\",\"user/Library.read\",\"user/Linkage.read\",\"user/List.read\",\"user/Location.read\",\"user/Measure.read\",\"user/MeasureReport.read\",\"user/Media.read\",\"user/Medication.read\",\"user/MedicationAdministration.read\",\"user/MedicationDispense.read\",\"user/MedicationRequest.read\",\"user/MedicationStatement.read\",\"user/MessageDefinition.read\",\"user/MessageHeader.read\",\"user/NamingSystem.read\",\"user/NutritionOrder.read\",\"user/Observation.read\",\"user/OperationDefinition.read\",\"user/OperationOutcome.read\",\"user/Organization.read\",\"user/Parameters.read\",\"user/Patient.read\",\"user/PaymentNotice.read\",\"user/PaymentReconciliation.read\",\"user/Person.read\",\"user/PlanDefinition.read\",\"user/Practitioner.read\",\"user/PractitionerRole.read\",\"user/Procedure.read\",\"user/ProcedureRequest.read\",\"user/ProcessRequest.read\",\"user/ProcessResponse.read\",\"user/Provenance.read\",\"user/Questionnaire.read\",\"user/QuestionnaireResponse.read\",\"user/ReferralRequest.read\",\"user/RelatedPerson.read\",\"user/RequestGroup.read\",\"user/ResearchStudy.read\",\"user/ResearchSubject.read\",\"user/RiskAssessment.read\",\"user/Schedule.read\",\"user/SearchParameter.read\",\"user/Sequence.read\",\"user/ServiceDefinition.read\",\"user/Slot.read\",\"user/Specimen.read\",\"user/StructureDefinition.read\",\"user/StructureMap.read\",\"user/Subscription.read\",\"user/Substance.read\",\"user/SupplyDelivery.read\",\"user/SupplyRequest.read\",\"user/Task.read\",\"user/TestScript.read\",\"user/TestReport.read\",\"user/ValueSet.read\",\"user/VisionPrescription.read\",\"user/Account.write\",\"user/ActivityDefinition.write\",\"user/AllergyIntolerance.write\",\"user/AdverseEvent.write\",\"user/Appointment.write\",\"user/AppointmentResponse.write\",\"user/AuditEvent.write\",\"user/Basic.write\",\"user/Binary.write\",\"user/BodySite.write\",\"user/Bundle.write\",\"user/CapabilityStatement.write\",\"user/CarePlan.write\",\"user/CareTeam.write\",\"user/ChargeItem.write\",\"user/Claim.write\",\"user/ClaimResponse.write\",\"user/ClinicalImpression.write\",\"user/CodeSystem.write\",\"user/Communication.write\",\"user/CommunicationRequest.write\",\"user/CompartmentDefinition.write\",\"user/Composition.write\",\"user/ConceptMap.write\",\"user/Condition.write\",\"user/Consent.write\",\"user/Contract.write\",\"user/Coverage.write\",\"user/DataElement.write\",\"user/DetectedIssue.write\",\"user/Device.write\",\"user/DeviceComponent.write\",\"user/DeviceMetric.write\",\"user/DeviceRequest.write\",\"user/DeviceUseStatement.write\",\"user/DiagnosticReport.write\",\"user/DocumentManifest.write\",\"user/DocumentReference.write\",\"user/EligibilityRequest.write\",\"user/EligibilityResponse.write\",\"user/Encounter.write\",\"user/Endpoint.write\",\"user/EnrollmentRequest.write\",\"user/EnrollmentResponse.write\",\"user/EpisodeOfCare.write\",\"user/ExpansionProfile.write\",\"user/ExplanationOfBenefit.write\",\"user/FamilyMemberHistory.write\",\"user/Flag.write\",\"user/Goal.write\",\"user/GraphDefinition.write\",\"user/Group.write\",\"user/GuidanceResponse.write\",\"user/HealthcareService.write\",\"user/ImagingManifest.write\",\"user/ImagingStudy.write\",\"user/Immunization.write\",\"user/ImmunizationRecommendation.write\",\"user/ImplementationGuide.write\",\"user/Library.write\",\"user/Linkage.write\",\"user/List.write\",\"user/Location.write\",\"user/Measure.write\",\"user/MeasureReport.write\",\"user/Media.write\",\"user/Medication.write\",\"user/MedicationAdministration.write\",\"user/MedicationDispense.write\",\"user/MedicationRequest.write\",\"user/MedicationStatement.write\",\"user/MessageDefinition.write\",\"user/MessageHeader.write\",\"user/NamingSystem.write\",\"user/NutritionOrder.write\",\"user/Observation.write\",\"user/OperationDefinition.write\",\"user/OperationOutcome.write\",\"user/Organization.write\",\"user/Parameters.write\",\"user/Patient.write\",\"user/PaymentNotice.write\",\"user/PaymentReconciliation.write\",\"user/Person.write\",\"user/PlanDefinition.write\",\"user/Practitioner.write\",\"user/PractitionerRole.write\",\"user/Procedure.write\",\"user/ProcedureRequest.write\",\"user/ProcessRequest.write\",\"user/ProcessResponse.write\",\"user/Provenance.write\",\"user/Questionnaire.write\",\"user/QuestionnaireResponse.write\",\"user/ReferralRequest.write\",\"user/RelatedPerson.write\",\"user/RequestGroup.write\",\"user/ResearchStudy.write\",\"user/ResearchSubject.write\",\"user/RiskAssessment.write\",\"user/Schedule.write\",\"user/SearchParameter.write\",\"user/Sequence.write\",\"user/ServiceDefinition.write\",\"user/Slot.write\",\"user/Specimen.write\",\"user/StructureDefinition.write\",\"user/StructureMap.write\",\"user/Subscription.write\",\"user/Substance.write\",\"user/SupplyDelivery.write\",\"user/SupplyRequest.write\",\"user/Task.write\",\"user/TestScript.write\",\"user/TestReport.write\",\"user/ValueSet.write\",\"user/VisionPrescription.write\",\"system/Account.read\",\"system/ActivityDefinition.read\",\"system/AllergyIntolerance.read\",\"system/AdverseEvent.read\",\"system/Appointment.read\",\"system/AppointmentResponse.read\",\"system/AuditEvent.read\",\"system/Basic.read\",\"system/Binary.read\",\"system/BodySite.read\",\"system/Bundle.read\",\"system/CapabilityStatement.read\",\"system/CarePlan.read\",\"system/CareTeam.read\",\"system/ChargeItem.read\",\"system/Claim.read\",\"system/ClaimResponse.read\",\"system/ClinicalImpression.read\",\"system/CodeSystem.read\",\"system/Communication.read\",\"system/CommunicationRequest.read\",\"system/CompartmentDefinition.read\",\"system/Composition.read\",\"system/ConceptMap.read\",\"system/Condition.read\",\"system/Consent.read\",\"system/Contract.read\",\"system/Coverage.read\",\"system/DataElement.read\",\"system/DetectedIssue.read\",\"system/Device.read\",\"system/DeviceComponent.read\",\"system/DeviceMetric.read\",\"system/DeviceRequest.read\",\"system/DeviceUseStatement.read\",\"system/DiagnosticReport.read\",\"system/DocumentManifest.read\",\"system/DocumentReference.read\",\"system/EligibilityRequest.read\",\"system/EligibilityResponse.read\",\"system/Encounter.read\",\"system/Endpoint.read\",\"system/EnrollmentRequest.read\",\"system/EnrollmentResponse.read\",\"system/EpisodeOfCare.read\",\"system/ExpansionProfile.read\",\"system/ExplanationOfBenefit.read\",\"system/FamilyMemberHistory.read\",\"system/Flag.read\",\"system/Goal.read\",\"system/GraphDefinition.read\",\"system/Group.read\",\"system/GuidanceResponse.read\",\"system/HealthcareService.read\",\"system/ImagingManifest.read\",\"system/ImagingStudy.read\",\"system/Immunization.read\",\"system/ImmunizationRecommendation.read\",\"system/ImplementationGuide.read\",\"system/Library.read\",\"system/Linkage.read\",\"system/List.read\",\"system/Location.read\",\"system/Measure.read\",\"system/MeasureReport.read\",\"system/Media.read\",\"system/Medication.read\",\"system/MedicationAdministration.read\",\"system/MedicationDispense.read\",\"system/MedicationRequest.read\",\"system/MedicationStatement.read\",\"system/MessageDefinition.read\",\"system/MessageHeader.read\",\"system/NamingSystem.read\",\"system/NutritionOrder.read\",\"system/Observation.read\",\"system/OperationDefinition.read\",\"system/OperationOutcome.read\",\"system/Organization.read\",\"system/Parameters.read\",\"system/Patient.read\",\"system/PaymentNotice.read\",\"system/PaymentReconciliation.read\",\"system/Person.read\",\"system/PlanDefinition.read\",\"system/Practitioner.read\",\"system/PractitionerRole.read\",\"system/Procedure.read\",\"system/ProcedureRequest.read\",\"system/ProcessRequest.read\",\"system/ProcessResponse.read\",\"system/Provenance.read\",\"system/Questionnaire.read\",\"system/QuestionnaireResponse.read\",\"system/ReferralRequest.read\",\"system/RelatedPerson.read\",\"system/RequestGroup.read\",\"system/ResearchStudy.read\",\"system/ResearchSubject.read\",\"system/RiskAssessment.read\",\"system/Schedule.read\",\"system/SearchParameter.read\",\"system/Sequence.read\",\"system/ServiceDefinition.read\",\"system/Slot.read\",\"system/Specimen.read\",\"system/StructureDefinition.read\",\"system/StructureMap.read\",\"system/Subscription.read\",\"system/Substance.read\",\"system/SupplyDelivery.read\",\"system/SupplyRequest.read\",\"system/Task.read\",\"system/TestScript.read\",\"system/TestReport.read\",\"system/ValueSet.read\",\"system/VisionPrescription.read\",\"system/Account.write\",\"system/ActivityDefinition.write\",\"system/AllergyIntolerance.write\",\"system/AdverseEvent.write\",\"system/Appointment.write\",\"system/AppointmentResponse.write\",\"system/AuditEvent.write\",\"system/Basic.write\",\"system/Binary.write\",\"system/BodySite.write\",\"system/Bundle.write\",\"system/CapabilityStatement.write\",\"system/CarePlan.write\",\"system/CareTeam.write\",\"system/ChargeItem.write\",\"system/Claim.write\",\"system/ClaimResponse.write\",\"system/ClinicalImpression.write\",\"system/CodeSystem.write\",\"system/Communication.write\",\"system/CommunicationRequest.write\",\"system/CompartmentDefinition.write\",\"system/Composition.write\",\"system/ConceptMap.write\",\"system/Condition.write\",\"system/Consent.write\",\"system/Contract.write\",\"system/Coverage.write\",\"system/DataElement.write\",\"system/DetectedIssue.write\",\"system/Device.write\",\"system/DeviceComponent.write\",\"system/DeviceMetric.write\",\"system/DeviceRequest.write\",\"system/DeviceUseStatement.write\",\"system/DiagnosticReport.write\",\"system/DocumentManifest.write\",\"system/DocumentReference.write\",\"system/EligibilityRequest.write\",\"system/EligibilityResponse.write\",\"system/Encounter.write\",\"system/Endpoint.write\",\"system/EnrollmentRequest.write\",\"system/EnrollmentResponse.write\",\"system/EpisodeOfCare.write\",\"system/ExpansionProfile.write\",\"system/ExplanationOfBenefit.write\",\"system/FamilyMemberHistory.write\",\"system/Flag.write\",\"system/Goal.write\",\"system/GraphDefinition.write\",\"system/Group.write\",\"system/GuidanceResponse.write\",\"system/HealthcareService.write\",\"system/ImagingManifest.write\",\"system/ImagingStudy.write\",\"system/Immunization.write\",\"system/ImmunizationRecommendation.write\",\"system/ImplementationGuide.write\",\"system/Library.write\",\"system/Linkage.write\",\"system/List.write\",\"system/Location.write\",\"system/Measure.write\",\"system/MeasureReport.write\",\"system/Media.write\",\"system/Medication.write\",\"system/MedicationAdministration.write\",\"system/MedicationDispense.write\",\"system/MedicationRequest.write\",\"system/MedicationStatement.write\",\"system/MessageDefinition.write\",\"system/MessageHeader.write\",\"system/NamingSystem.write\",\"system/NutritionOrder.write\",\"system/Observation.write\",\"system/OperationDefinition.write\",\"system/OperationOutcome.write\",\"system/Organization.write\",\"system/Parameters.write\",\"system/Patient.write\",\"system/PaymentNotice.write\",\"system/PaymentReconciliation.write\",\"system/Person.write\",\"system/PlanDefinition.write\",\"system/Practitioner.write\"`
stu3_scopes=` echo $stu3_scopes,\"system/PractitionerRole.write\",\"system/Procedure.write\",\"system/ProcedureRequest.write\",\"system/ProcessRequest.write\",\"system/ProcessResponse.write\",\"system/Provenance.write\",\"system/Questionnaire.write\",\"system/QuestionnaireResponse.write\",\"system/ReferralRequest.write\",\"system/RelatedPerson.write\",\"system/RequestGroup.write\",\"system/ResearchStudy.write\",\"system/ResearchSubject.write\",\"system/RiskAssessment.write\",\"system/Schedule.write\",\"system/SearchParameter.write\",\"system/Sequence.write\",\"system/ServiceDefinition.write\",\"system/Slot.write\",\"system/Specimen.write\",\"system/StructureDefinition.write\",\"system/StructureMap.write\",\"system/Subscription.write\",\"system/Substance.write\",\"system/SupplyDelivery.write\",\"system/SupplyRequest.write\",\"system/Task.write\",\"system/TestScript.write\",\"system/TestReport.write\",\"system/ValueSet.write\",\"system/VisionPrescription.write\"`

dstu2_scopes=` echo \"patient/AllergyIntolerance.read\",\"patient/Appointment.read\",\"patient/AppointmentResponse.read\",\"patient/AuditEvent.read\",\"patient/Basic.read\",\"patient/Binary.read\",\"patient/BodySite.read\",\"patient/Bundle.read\",\"patient/CarePlan.read\",\"patient/Claim.read\",\"patient/ClaimResponse.read\",\"patient/ClinicalImpression.read\",\"patient/Communication.read\",\"patient/CommunicationRequest.read\",\"patient/Composition.read\",\"patient/ConceptMap.read\",\"patient/Condition.read\",\"patient/Conformance.read\",\"patient/Contract.read\",\"patient/DetectedIssue.read\",\"patient/Coverage.read\",\"patient/DataElement.read\",\"patient/Device.read\",\"patient/DeviceComponent.read\",\"patient/DeviceMetric.read\",\"patient/DeviceUseRequest.read\",\"patient/DeviceUseStatement.read\",\"patient/DiagnosticOrder.read\",\"patient/DiagnosticReport.read\",\"patient/DocumentManifest.read\",\"patient/DocumentReference.read\",\"patient/EligibilityRequest.read\",\"patient/EligibilityResponse.read\",\"patient/Encounter.read\",\"patient/EnrollmentRequest.read\",\"patient/EnrollmentResponse.read\",\"patient/EpisodeOfCare.read\",\"patient/ExplanationOfBenefit.read\",\"patient/FamilyMemberHistory.read\",\"patient/Flag.read\",\"patient/Goal.read\",\"patient/Group.read\",\"patient/HealthcareService.read\",\"patient/ImagingObjectSelection.read\",\"patient/ImagingStudy.read\",\"patient/Immunization.read\",\"patient/ImmunizationRecommendation.read\",\"patient/ImplementationGuide.read\",\"patient/List.read\",\"patient/Location.read\",\"patient/Media.read\",\"patient/Medication.read\",\"patient/MedicationAdministration.read\",\"patient/MedicationDispense.read\",\"patient/MedicationOrder.read\",\"patient/MedicationStatement.read\",\"patient/MessageHeader.read\",\"patient/NamingSystem.read\",\"patient/NutritionOrder.read\",\"patient/Observation.read\",\"patient/OperationDefinition.read\",\"patient/OperationOutcome.read\",\"patient/Order.read\",\"patient/OrderResponse.read\",\"patient/Organization.read\",\"patient/Parameters.read\",\"patient/Patient.read\",\"patient/PaymentNotice.read\",\"patient/PaymentReconciliation.read\",\"patient/Person.read\",\"patient/Practitioner.read\",\"patient/Procedure.read\",\"patient/ProcessRequest.read\",\"patient/ProcessResponse.read\",\"patient/ProcedureRequest.read\",\"patient/Provenance.read\",\"patient/Questionnaire.read\",\"patient/QuestionnaireResponse.read\",\"patient/ReferralRequest.read\",\"patient/RelatedPerson.read\",\"patient/RiskAssessment.read\",\"patient/Schedule.read\",\"patient/SearchParameter.read\",\"patient/Slot.read\",\"patient/Specimen.read\",\"patient/StructureDefinition.read\",\"patient/Subscription.read\",\"patient/Substance.read\",\"patient/SupplyRequest.read\",\"patient/SupplyDelivery.read\",\"patient/TestScript.read\",\"patient/ValueSet.read\",\"patient/VisionPrescription.read\",\"patient/AllergyIntolerance.write\",\"patient/Appointment.write\",\"patient/AppointmentResponse.write\",\"patient/AuditEvent.write\",\"patient/Basic.write\",\"patient/Binary.write\",\"patient/BodySite.write\",\"patient/Bundle.write\",\"patient/CarePlan.write\",\"patient/Claim.write\",\"patient/ClaimResponse.write\",\"patient/ClinicalImpression.write\",\"patient/Communication.write\",\"patient/CommunicationRequest.write\",\"patient/Composition.write\",\"patient/ConceptMap.write\",\"patient/Condition.write\",\"patient/Conformance.write\",\"patient/Contract.write\",\"patient/DetectedIssue.write\",\"patient/Coverage.write\",\"patient/DataElement.write\",\"patient/Device.write\",\"patient/DeviceComponent.write\",\"patient/DeviceMetric.write\",\"patient/DeviceUseRequest.write\",\"patient/DeviceUseStatement.write\",\"patient/DiagnosticOrder.write\",\"patient/DiagnosticReport.write\",\"patient/DocumentManifest.write\",\"patient/DocumentReference.write\",\"patient/EligibilityRequest.write\",\"patient/EligibilityResponse.write\",\"patient/Encounter.write\",\"patient/EnrollmentRequest.write\",\"patient/EnrollmentResponse.write\",\"patient/EpisodeOfCare.write\",\"patient/ExplanationOfBenefit.write\",\"patient/FamilyMemberHistory.write\",\"patient/Flag.write\",\"patient/Goal.write\",\"patient/Group.write\",\"patient/HealthcareService.write\",\"patient/ImagingObjectSelection.write\",\"patient/ImagingStudy.write\",\"patient/Immunization.write\",\"patient/ImmunizationRecommendation.write\",\"patient/ImplementationGuide.write\",\"patient/List.write\",\"patient/Location.write\",\"patient/Media.write\",\"patient/Medication.write\",\"patient/MedicationAdministration.write\",\"patient/MedicationDispense.write\",\"patient/MedicationOrder.write\",\"patient/MedicationStatement.write\",\"patient/MessageHeader.write\",\"patient/NamingSystem.write\",\"patient/NutritionOrder.write\",\"patient/Observation.write\",\"patient/OperationDefinition.write\",\"patient/OperationOutcome.write\",\"patient/Order.write\",\"patient/OrderResponse.write\",\"patient/Organization.write\",\"patient/Parameters.write\",\"patient/Patient.write\",\"patient/PaymentNotice.write\",\"patient/PaymentReconciliation.write\",\"patient/Person.write\",\"patient/Practitioner.write\",\"patient/Procedure.write\",\"patient/ProcessRequest.write\",\"patient/ProcessResponse.write\",\"patient/ProcedureRequest.write\",\"patient/Provenance.write\",\"patient/Questionnaire.write\",\"patient/QuestionnaireResponse.write\",\"patient/ReferralRequest.write\",\"patient/RelatedPerson.write\",\"patient/RiskAssessment.write\",\"patient/Schedule.write\",\"patient/SearchParameter.write\",\"patient/Slot.write\",\"patient/Specimen.write\",\"patient/StructureDefinition.write\",\"patient/Subscription.write\",\"patient/Substance.write\",\"patient/SupplyRequest.write\",\"patient/SupplyDelivery.write\",\"patient/TestScript.write\",\"patient/ValueSet.write\",\"patient/VisionPrescription.write\",\"user/AllergyIntolerance.read\",\"user/Appointment.read\",\"user/AppointmentResponse.read\",\"user/AuditEvent.read\",\"user/Basic.read\",\"user/Binary.read\",\"user/BodySite.read\",\"user/Bundle.read\",\"user/CarePlan.read\",\"user/Claim.read\",\"user/ClaimResponse.read\",\"user/ClinicalImpression.read\",\"user/Communication.read\",\"user/CommunicationRequest.read\",\"user/Composition.read\",\"user/ConceptMap.read\",\"user/Condition.read\",\"user/Conformance.read\",\"user/Contract.read\",\"user/DetectedIssue.read\",\"user/Coverage.read\",\"user/DataElement.read\",\"user/Device.read\",\"user/DeviceComponent.read\",\"user/DeviceMetric.read\",\"user/DeviceUseRequest.read\",\"user/DeviceUseStatement.read\",\"user/DiagnosticOrder.read\",\"user/DiagnosticReport.read\",\"user/DocumentManifest.read\",\"user/DocumentReference.read\",\"user/EligibilityRequest.read\",\"user/EligibilityResponse.read\",\"user/Encounter.read\",\"user/EnrollmentRequest.read\",\"user/EnrollmentResponse.read\",\"user/EpisodeOfCare.read\",\"user/ExplanationOfBenefit.read\",\"user/FamilyMemberHistory.read\",\"user/Flag.read\",\"user/Goal.read\",\"user/Group.read\",\"user/HealthcareService.read\",\"user/ImagingObjectSelection.read\",\"user/ImagingStudy.read\",\"user/Immunization.read\",\"user/ImmunizationRecommendation.read\",\"user/ImplementationGuide.read\",\"user/List.read\",\"user/Location.read\",\"user/Media.read\",\"user/Medication.read\",\"user/MedicationAdministration.read\",\"user/MedicationDispense.read\",\"user/MedicationOrder.read\",\"user/MedicationStatement.read\",\"user/MessageHeader.read\",\"user/NamingSystem.read\",\"user/NutritionOrder.read\",\"user/Observation.read\",\"user/OperationDefinition.read\",\"user/OperationOutcome.read\",\"user/Order.read\",\"user/OrderResponse.read\",\"user/Organization.read\",\"user/Parameters.read\",\"user/Patient.read\",\"user/PaymentNotice.read\",\"user/PaymentReconciliation.read\",\"user/Person.read\",\"user/Practitioner.read\",\"user/Procedure.read\",\"user/ProcessRequest.read\",\"user/ProcessResponse.read\",\"user/ProcedureRequest.read\",\"user/Provenance.read\",\"user/Questionnaire.read\",\"user/QuestionnaireResponse.read\",\"user/ReferralRequest.read\",\"user/RelatedPerson.read\",\"user/RiskAssessment.read\",\"user/Schedule.read\",\"user/SearchParameter.read\",\"user/Slot.read\",\"user/Specimen.read\",\"user/StructureDefinition.read\",\"user/Subscription.read\",\"user/Substance.read\",\"user/SupplyRequest.read\",\"user/SupplyDelivery.read\",\"user/TestScript.read\",\"user/ValueSet.read\",\"user/VisionPrescription.read\"`
dstu2_scope=` echo $dstu2_scopes,\"user/AllergyIntolerance.write\",\"user/Appointment.write\",\"user/AppointmentResponse.write\",\"user/AuditEvent.write\",\"user/Basic.write\",\"user/Binary.write\",\"user/BodySite.write\",\"user/Bundle.write\",\"user/CarePlan.write\",\"user/Claim.write\",\"user/ClaimResponse.write\",\"user/ClinicalImpression.write\",\"user/Communication.write\",\"user/CommunicationRequest.write\",\"user/Composition.write\",\"user/ConceptMap.write\",\"user/Condition.write\",\"user/Conformance.write\",\"user/Contract.write\",\"user/DetectedIssue.write\",\"user/Coverage.write\",\"user/DataElement.write\",\"user/Device.write\",\"user/DeviceComponent.write\",\"user/DeviceMetric.write\",\"user/DeviceUseRequest.write\",\"user/DeviceUseStatement.write\",\"user/DiagnosticOrder.write\",\"user/DiagnosticReport.write\",\"user/DocumentManifest.write\",\"user/DocumentReference.write\",\"user/EligibilityRequest.write\",\"user/EligibilityResponse.write\",\"user/Encounter.write\",\"user/EnrollmentRequest.write\",\"user/EnrollmentResponse.write\",\"user/EpisodeOfCare.write\",\"user/ExplanationOfBenefit.write\",\"user/FamilyMemberHistory.write\",\"user/Flag.write\",\"user/Goal.write\",\"user/Group.write\",\"user/HealthcareService.write\",\"user/ImagingObjectSelection.write\",\"user/ImagingStudy.write\",\"user/Immunization.write\",\"user/ImmunizationRecommendation.write\",\"user/ImplementationGuide.write\",\"user/List.write\",\"user/Location.write\",\"user/Media.write\",\"user/Medication.write\",\"user/MedicationAdministration.write\",\"user/MedicationDispense.write\",\"user/MedicationOrder.write\",\"user/MedicationStatement.write\",\"user/MessageHeader.write\",\"user/NamingSystem.write\",\"user/NutritionOrder.write\",\"user/Observation.write\",\"user/OperationDefinition.write\",\"user/OperationOutcome.write\",\"user/Order.write\",\"user/OrderResponse.write\",\"user/Organization.write\",\"user/Parameters.write\",\"user/Patient.write\",\"user/PaymentNotice.write\",\"user/PaymentReconciliation.write\",\"user/Person.write\",\"user/Practitioner.write\",\"user/Procedure.write\",\"user/ProcessRequest.write\",\"user/ProcessResponse.write\",\"user/ProcedureRequest.write\",\"user/Provenance.write\",\"user/Questionnaire.write\",\"user/QuestionnaireResponse.write\",\"user/ReferralRequest.write\",\"user/RelatedPerson.write\",\"user/RiskAssessment.write\",\"user/Schedule.write\",\"user/SearchParameter.write\",\"user/Slot.write\",\"user/Specimen.write\",\"user/StructureDefinition.write\",\"user/Subscription.write\",\"user/Substance.write\",\"user/SupplyRequest.write\",\"user/SupplyDelivery.write\",\"user/TestScript.write\",\"user/ValueSet.write\",\"user/VisionPrescription.write\",\"system/AllergyIntolerance.read\",\"system/Appointment.read\",\"system/AppointmentResponse.read\",\"system/AuditEvent.read\",\"system/Basic.read\",\"system/Binary.read\",\"system/BodySite.read\",\"system/Bundle.read\",\"system/CarePlan.read\",\"system/Claim.read\",\"system/ClaimResponse.read\",\"system/ClinicalImpression.read\",\"system/Communication.read\",\"system/CommunicationRequest.read\",\"system/Composition.read\",\"system/ConceptMap.read\",\"system/Condition.read\",\"system/Conformance.read\",\"system/Contract.read\",\"system/DetectedIssue.read\",\"system/Coverage.read\",\"system/DataElement.read\",\"system/Device.read\",\"system/DeviceComponent.read\",\"system/DeviceMetric.read\",\"system/Devicesystemequest.read\",\"system/DeviceUseStatement.read\",\"system/DiagnosticOrder.read\",\"system/DiagnosticReport.read\",\"system/DocumentManifest.read\",\"system/DocumentReference.read\",\"system/EligibilityRequest.read\",\"system/EligibilityResponse.read\",\"system/Encounter.read\",\"system/EnrollmentRequest.read\",\"system/EnrollmentResponse.read\",\"system/EpisodeOfCare.read\",\"system/ExplanationOfBenefit.read\",\"system/FamilyMemberHistory.read\",\"system/Flag.read\",\"system/Goal.read\",\"system/Group.read\",\"system/HealthcareService.read\",\"system/ImagingObjectSelection.read\",\"system/ImagingStudy.read\",\"system/Immunization.read\",\"system/ImmunizationRecommendation.read\",\"system/ImplementationGuide.read\",\"system/List.read\",\"system/Location.read\",\"system/Media.read\",\"system/Medication.read\",\"system/MedicationAdministration.read\",\"system/MedicationDispense.read\",\"system/MedicationOrder.read\",\"system/MedicationStatement.read\",\"system/MessageHeader.read\",\"system/NamingSystem.read\",\"system/NutritionOrder.read\",\"system/Observation.read\",\"system/OperationDefinition.read\",\"system/OperationOutcome.read\",\"system/Order.read\",\"system/OrderResponse.read\",\"system/Organization.read\",\"system/Parameters.read\",\"system/Patient.read\",\"system/PaymentNotice.read\",\"system/PaymentReconciliation.read\",\"system/Person.read\",\"system/Practitioner.read\",\"system/Procedure.read\",\"system/ProcessRequest.read\",\"system/ProcessResponse.read\",\"system/ProcedureRequest.read\",\"system/Provenance.read\",\"system/Questionnaire.read\",\"system/QuestionnaireResponse.read\",\"system/ReferralRequest.read\",\"system/RelatedPerson.read\",\"system/RiskAssessment.read\",\"system/Schedule.read\",\"system/SearchParameter.read\",\"system/Slot.read\",\"system/Specimen.read\",\"system/StructureDefinition.read\",\"system/Subscription.read\",\"system/Substance.read\",\"system/SupplyRequest.read\",\"system/SupplyDelivery.read\",\"system/TestScript.read\",\"system/ValueSet.read\",\"system/VisionPrescription.read\",\"system/AllergyIntolerance.write\",\"system/Appointment.write\",\"system/AppointmentResponse.write\",\"system/AuditEvent.write\",\"system/Basic.write\",\"system/Binary.write\",\"system/BodySite.write\",\"system/Bundle.write\",\"system/CarePlan.write\",\"system/Claim.write\",\"system/ClaimResponse.write\",\"system/ClinicalImpression.write\",\"system/Communication.write\",\"system/CommunicationRequest.write\",\"system/Composition.write\",\"system/ConceptMap.write\",\"system/Condition.write\",\"system/Conformance.write\",\"system/Contract.write\",\"system/DetectedIssue.write\",\"system/Coverage.write\",\"system/DataElement.write\",\"system/Device.write\",\"system/DeviceComponent.write\",\"system/DeviceMetric.write\",\"system/Devicesystemequest.write\",\"system/DeviceUseStatement.write\",\"system/DiagnosticOrder.write\",\"system/DiagnosticReport.write\",\"system/DocumentManifest.write\",\"system/DocumentReference.write\",\"system/EligibilityRequest.write\",\"system/EligibilityResponse.write\",\"system/Encounter.write\",\"system/EnrollmentRequest.write\",\"system/EnrollmentResponse.write\",\"system/EpisodeOfCare.write\",\"system/ExplanationOfBenefit.write\",\"system/FamilyMemberHistory.write\",\"system/Flag.write\",\"system/Goal.write\",\"system/Group.write\",\"system/HealthcareService.write\",\"system/ImagingObjectSelection.write\",\"system/ImagingStudy.write\",\"system/Immunization.write\",\"system/ImmunizationRecommendation.write\",\"system/ImplementationGuide.write\",\"system/List.write\",\"system/Location.write\",\"system/Media.write\",\"system/Medication.write\",\"system/MedicationAdministration.write\",\"system/MedicationDispense.write\",\"system/MedicationOrder.write\",\"system/MedicationStatement.write\",\"system/MessageHeader.write\",\"system/NamingSystem.write\",\"system/NutritionOrder.write\",\"system/Observation.write\",\"system/OperationDefinition.write\",\"system/OperationOutcome.write\",\"system/Order.write\",\"system/OrderResponse.write\",\"system/Organization.write\",\"system/Parameters.write\",\"system/Patient.write\",\"system/PaymentNotice.write\",\"system/PaymentReconciliation.write\",\"system/Person.write\",\"system/Practitioner.write\",\"system/Procedure.write\",\"system/ProcessRequest.write\",\"system/ProcessResponse.write\",\"system/ProcedureRequest.write\",\"system/Provenance.write\",\"system/Questionnaire.write\",\"system/QuestionnaireResponse.write\",\"system/ReferralRequest.write\",\"system/RelatedPerson.write\",\"system/RiskAssessment.write\",\"system/Schedule.write\",\"system/SearchParameter.write\",\"system/Slot.write\",\"system/Specimen.write\",\"system/StructureDefinition.write\",\"system/Subscription.write\",\"system/Substance.write\",\"system/SupplyRequest.write\",\"system/SupplyDelivery.write\",\"system/TestScript.write\",\"system/ValueSet.write\",\"system/VisionPrescription.write\"`

#Set Exit parameters
input_file_not_found=2
fhir_version_not_found=3
duplicate_fhirserver_directory_exists=4
proxy_files_processing_error=5
kvm_entry_creation_error=6
proxy_creation_error=7
product_creation_error=8
app_creation_error=9


#Get the Input file
inputFile=$1
echo "Starting with input file : `pwd`/$inputFile"
fhirServerName=`cat $inputFile | jq '.fhirserver.name' | sed 's/"//g'`
if [ $? -ne 0 ]; then
    echo "Fhir server name Or Input file not found."
    exit $input_file_not_found
fi

serviceAccountFile=`cat $inputFile | jq '.service_account.filename' | sed 's/"//g'`

customProxy=`cat $inputFile | jq '.fhirserver.isCustomProxy' | sed 's/"//g'`
if [ $? -ne 0 ]; then
    echo "Custom type not found."
    exit $fhir_version_not_found
fi

#Detect FHIR Verison from the Input file name
fhirVersion=`cat $inputFile | jq '.fhirserver.fhirversion' | sed 's/"//g' | awk '{print tolower($0)}'`
echo "FHIR version:  $fhirVersion"
if [ $? -ne 0 ]; then
    echo "Fhir version Or Input file not found"
    exit $fhir_version_not_found
fi

#Select the correct template folder based on FHIR version
echo "Selecting $fhirVersion template from the repository: "
templateName="fhir-${fhirVersion}-template"
if [ $? -ne 0 ]; then
    echo "template name could not be calculated"
    exit $fhir_version_not_found
fi
newProxyFolderLocation="${repositoryLocation}${proxyLocation}/${fhirServerName}"

#Check if the folder already exists and abort if exists
if [ -e $newProxyFolderLocation ]; then
    echo "Directory for the current configuration already exists. Are you using right configuration?"
    exit $duplicate_fhirserver_directory_exists
fi

#Copy the template content into new Proxy folder
echo "Creating Apigee Proxy folder for $fhirServerName"
shopt -s nocasematch
case $templateName in
  "fhir-stu3-template")
  echo "from $stu3_template"
  cp -r $stu3_template $newProxyFolderLocation
  ;;
  "fhir-dstu2-template")
  echo "from $dstu2_template"
  cp -r $dstu2_template $newProxyFolderLocation
  ;;
  "fhir-r4-template")
  echo "from $r4_template"
  cp -r $r4_template $newProxyFolderLocation
  ;;
esac
echo "Done..."
shopt -u nocasematch

#Update files in the new Proxy folder
#1 Update the Proxy name in proxyfolder/pom.xml
sed -i 's/'"${templateName}"'/'"${fhirServerName}"'/' $newProxyFolderLocation/pom.xml
if [ $? -ne 0 ]; then
    echo "Error processing pom file"
    exit $proxy_files_processing_error
fi

#2Update edge.json with Default Product name and proxy name
defaultProduct=`cat $inputFile | jq '.fhirserver.defaultproduct' | sed 's/"//g'`
proxyName=$fhirServerName
echo "Creating configuration with proxy $proxyName and DefaultProduct $defaultProduct"

#create a temp file to hold edge configuration temporarily
tmp=$(mktemp)

#3Update config.json with basepath /v1/{fhirVersion}/fhirServerName -- /v1/stu3/FHIRVersion_UUID
fhirServerKVMEntry=`echo $fhirServerName`
appName=`echo $fhirServerKVMEntry`_app
proxyBasePath=/v1/${fhirVersion}/$fhirServerKVMEntry
echo "setting basePath as - $proxyBasePath"


#4Update Proxybasepath in proxy endpoint default.xml
sed -i "s|/v1/${fhirVersion}|${proxyBasePath}|" $newProxyFolderLocation/apiproxy/proxies/default.xml
if [ $? -ne 0 ]; then
    echo "Error processing proxy configuration"
    exit $proxy_files_processing_error
fi

echo "Updated base path in proxy endpoint..."


#Remove tmp file
rm -rf $tmp

#5Update Target Servers - First confirm whether or not the Target servers need to change with Google team

#6 Create KVM Entry in HPX_FHIRServerServiceAccountCredentials with FHIR server name. Only entry to be created, KVM should exist before hand
echo "Creating KVM Entry for Fhir server $fhirServerKVMEntry"
kvmValue=`cat $serviceAccountFile`
apigeetool addEntryToKVM -u $4 -p $5 -o $2 -e $3 --mapName HPX_FHIRServerServiceAccountCredentials --entryName $fhirServerKVMEntry --entryValue "$kvmValue"
if [ $? -ne 0 ]; then
    echo "Error creating KVM entry for FHIR Server..."
    exit $kvm_entry_creation_error
fi


#7Run the maven command or call the setup.sh script to run configuration and deployment 
cd $newProxyFolderLocation
mvn install -Dorg=$2 -P$3 -Dusername=$4 -Dpassword=$5 -Dapigee.config.options=update
if [ $? -ne 0 ]; then
    echo "Error deploying proxy..."
    exit $proxy_creation_error
fi

#7.5Run the maven command or call the setup.sh script to run configuration and deployment 
cd $fhirApisProxy
mvn install -Dorg=$2 -P$3 -Dusername=$4 -Dpassword=$5 -Dapigee.config.options=update
if [ $? -ne 0 ]; then
    echo "Error deploying fhirApis proxy..."
    exit $proxy_creation_error
fi

#8Create Product
echo "Creating Product $defaultProduct"
cd $scriptDir
#Create Product
fhir_server_url=`cat $1 | jq '.fhirserver.proxyurl' | sed 's/"//g'`
project=`cat $1 | jq '.fhirserver.project' | sed 's/"//g'`
location=`cat $1 | jq '.fhirserver.location' | sed 's/"//g'`
dataset=`cat $1 | jq '.fhirserver.dataset' | sed 's/"//g'`
fhirstore=`cat $1 | jq '.fhirserver.fhirstorename' | sed 's/"//g'`
googleFhirstoreUrl=`cat $1 | jq '.fhirserver.googleFhirstoreUrl' | sed 's/"//g'`

productName=$defaultProduct
productDesc=$defaultProduct
proxyName=`cat $1 | jq '.fhirserver.name' | sed 's/"//g'`
proxies=\"$proxyName\",\"identity-consentmgmt-api\",\"identity-oauthv2-api\",\"fhirApis\"
quota=10000
quotaInterval=1
quotaTimeUnit=month
apiResources=/**
environment=$3
common_scopes=\"fhirUser\",\"openid\",\"launch/patient\",\"online_access\",\"offline_access\"
wildcard_scopes=\"patient/*.*\",\"user/*.*\",\"system/*.*\"
fhir_server_name=$fhirServerKVMEntry
fhir_version=$fhirVersion
is_fhir_server=true

apigeeUrl=https://api.enterprise.apigee.com/v1/organizations
orgName=$2
envName=$3
apigee_product_creation_url=$apigeeUrl/$orgName/apiproducts

default_app_kvm_key_name=""
scopes=""
if [ "R4" == $fhir_version ] || [ "r4" == $fhir_version ]
then 
    default_app_kvm_key_name="default.r4.fhir.app"
    scopes=$r4_scopes,$common_scopes,$wildcard_scopes
elif [ "STU3" == $fhir_version ] || [ "stu3" == $fhir_version ]
then 
    default_app_kvm_key_name="default.stu3.fhir.app"
    scopes=$stu3_scopes,$common_scopes,$wildcard_scopes
elif [ "DSTU2" == $fhir_version ] || [ "dstu2" == $fhir_version ]
then
    default_app_kvm_key_name="default.dstu2.fhir.app"
    scopes=$dstu2_scopes,$common_scopes,$wildcard_scopes
fi

create_product_payload()
{
  cat <<EOF
{
  "name" : "$productName",
  "displayName": "$productName",
  "approvalType": "auto",
  "attributes": [
    {
      "name": "google_fhirstore_url",
      "value": "$googleFhirstoreUrl"
    },
    {
      "name": "fhir_server_url",
      "value": "$fhir_server_url"
    },
    {
      "name": "is_fhir_server",
      "value": "true"
    }
  ],
  "description": "$productName",
  "apiResources": [ "$apiResources"],
  "environments": [ "$environment"],
  "proxies": [ $proxies ],
  "quota": "$quota",
  "quotaInterval": "$quotaInterval",
  "quotaTimeUnit": "$quotaTimeUnit",
  "scopes": [ $scopes ]
}
EOF
}

curl -i \
-H "Accept: application/json" \
-H "Content-Type:application/json" \
-u $4:$5 \
-X POST --data "$(create_product_payload)" "$apigee_product_creation_url"

if [ $? -ne 0 ]; then
    echo "Error creating product..."
    exit $product_creation_error
fi


#Create App
appName=$appName
fhir_Server_Product=$defaultProduct
fhir_Server_Name=$fhirServerKVMEntry
user=$4
pass=$5
developer=$6

postUrl=$apigeeUrl/$orgName/developers/$developer/apps
echo $postUrl

generate_post_data()
{
  cat <<EOF
{
  "name": "$appName",
  "apiProducts": [
    "$fhir_Server_Product"
  ],
  "keyExpiresIn": 2592000000,
  "attributes": [
    {
      "name": "DisplayName",
      "value": "$appName"
    }
  ],
  "callbackUrl": "https://localhost:3000/callback"
}
EOF
}

default_app_consumer_key=`curl -s \
-H "Accept: application/json" \
-H "Content-Type:application/json" \
-u $user:$pass \
-X POST --data "$(generate_post_data)" "$postUrl" | jq '.credentials[0].consumerKey' | sed -e 's/^"//' -e 's/"$//'`

if [ $? -ne 0 ] || [ "null" == $default_app_consumer_key ] 
then
    echo "Error creating sample app..."
    exit $app_creation_error
fi

echo "Creating KVM Entry in HPX_Config for default fhir app..."
apigeetool addEntryToKVM -u $user -p $pass -o $orgName -e $envName --mapName HPX_Config --entryName "$default_app_kvm_key_name" --entryValue "$default_app_consumer_key"
if [ $? -ne 0 ]; then
    echo "Error creating KVM entry for default fhir app..."
    exit $kvm_entry_creation_error
fi